function ShowcaseViewModel(){var e=this;e.fakeData=!0;e.servers=ko.observableArray();e.activeUsers=ko.observable(0);e.servers.push(new ServerViewModel("192.168.1.11","p61","Appliance A"));e.servers.push(new ServerViewModel("192.168.1.12","p62","Appliance B"));e.servers.push(new ServerViewModel("192.168.1.13","p63","Appliance C"));e.keepUpdating=!0;e.updateIntervalMs=1e3;e.startPolling=function(){e.loadGossip();e.loadPower()};e.loadGossip=function(){if(e.fakeData){e.processGossip(fakeGossip);e.keepUpdating&&setTimeout(e.loadGossip,e.updateIntervalMs)}else $.ajax({url:"gossip",error:function(t,n,r){e.displayError(data.status.message)},success:function(t,n,r){e.processGossip(t);e.keepUpdating&&setTimeout(e.loadGossip,e.updateIntervalMs)}})};e.loadPower=function(){if(e.fakeData){e.processPower("p61=1,p62=0,p63=1,p64=1");e.keepUpdating&&setTimeout(e.loadPower,e.updateIntervalMs)}else $.ajax({url:"power/status",error:function(t,n,r){e.displayError(data.status.message)},success:function(t,n,r){e.processPower(t);e.keepUpdating&&setTimeout(e.loadPower,e.updateIntervalMs)}})};e.processGossip=function(t){for(var n=0;n<t.members.length;++n){var r=t.members[n];if(r.state==="Manager")continue;for(var i=0;i<e.servers().length;++i)e.servers()[i].ip===r.externalTcpIp&&e.servers()[i].populateFromGossip(r)}};e.processPower=function(t){var n=t.split(",");if(n.length!=4){e.displayError("Power data is not in the expected format");return}for(var r=0;r<n.length;++r){var i=n[r].split("=");i.length!=2&&e.displayError("Power data is not in the expected format");for(var s=0;s<e.servers().length;++s)e.servers()[s].powerCode===i[0]&&e.servers()[s].poweredOn(i[1]==="1"?!0:!1)}};e.displayError=function(t){e.keepUpdating=!1;alert(t)}}function ServerViewModel(e,t,n){var r=this;r.serverName=ko.observable(n);r.ip=e;r.powerCode=t;r.poweredOn=ko.observable(!0);r.powerText=ko.computed(function(){return r.poweredOn()?"ON":"OFF"});r.isAlive=ko.observable(!0);r.aliveText=ko.computed(function(){return r.isAlive()?"Alive":"Dead"});r.state=ko.observable("unknown");r.writerCheckpoint=ko.observable(0);r.chaserCheckpoint=ko.observable(0);r.populateFromGossip=function(e){r.isAlive(e.isAlive);r.state(e.state);r.writerCheckpoint(e.writerCheckpoint);r.chaserCheckpoint(e.chaserCheckpoint)};r.togglePower=function(){console.log("click");r.poweredOn()?r.poweredOn(!1):r.poweredOn(!0)}}var fakeGossip={members:[{state:"Master",isAlive:!0,externalTcpIp:"192.168.1.11",writerCheckpoint:1632951848,chaserCheckpoint:1632951848},{state:"Slave",isAlive:!1,externalTcpIp:"192.168.1.12",writerCheckpoint:1632951848,chaserCheckpoint:1632951848},{state:"Slave",isAlive:!0,externalTcpIp:"192.168.1.13",writerCheckpoint:1632951848,chaserCheckpoint:1632951848}]};